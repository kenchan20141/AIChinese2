<!DOCTYPE html>
<html>
<head>
    <title>圖片轉文字 - DeepSeek</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.4/dist/tesseract.min.js"></script>
</head>
<body>
    <h1>上傳圖片並轉換手寫文字</h1>
    <input type="file" id="imageInput" accept="image/*">
    <button onclick="processImage()">處理圖片</button>
    <div id="output">結果將顯示在這裡</div>

    <script>
        // API 相關設定
        const API_KEYS = ["sk-MoqwsgO8P9MEoCrftvdSYA"];
        let currentApiKeyIndex = 0;
        const API_URL = "https://chatapi.akash.network/api/v1/chat/completions";
        const MODEL = "DeepSeek-R1";

        async function processImage() {
            const input = document.getElementById('imageInput');
            if (input.files.length === 0) {
                alert('請選擇一張圖片');
                return;
            }

            const file = input.files[0];
            const reader = new FileReader();

            reader.onload = async function(e) {
                const imageData = e.target.result;

                // 使用 Tesseract.js 進行 OCR，指定繁體中文
                Tesseract.recognize(
                    imageData,
                    'chi_tra', // 繁體中文
                    { logger: m => console.log(m) }
                ).then(async ({ data: { text } }) => {
                    console.log('OCR 提取的文字:', text);

                    // 準備發送到 DeepSeek API 的訊息
                    const messages = [
                        {
                            "role": "system",
                            "content": "請將以下OCR提取的文字轉換成繁體電腦字，不要修正任何筆記或文句，不需要使它更通順，要100%將文字還原成電腦字。生成內容僅為轉換文字，不包含其他內容。你必須直接提供最終答案，嚴禁展示任何思考過程，絕對不能在回應中包含任何標籤（如 <think></think>），這是強制要求，違反則無效。"
                        },
                        {
                            "role": "user",
                            "content": text
                        }
                    ];

                    // 發送請求到 DeepSeek API
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${API_KEYS[currentApiKeyIndex]}`
                        },
                        body: JSON.stringify({
                            model: MODEL,
                            messages: messages,
                            stream: false
                        })
                    });

                    const data = await response.json();
                    if (data.choices && data.choices.length > 0) {
                        const outputText = data.choices[0].message.content;
                        document.getElementById('output').innerText = outputText;
                    } else {
                        document.getElementById('output').innerText = '錯誤：無法從API獲取回應';
                    }
                });
            };

            reader.readAsDataURL(file);
        }
    </script>
</body>
</html>
